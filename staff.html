<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TOGATHER | Staff Dashboard</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css"/>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; font-family:"Poppins", sans-serif;}
    body, html { height:100%; overflow:hidden; color:white; display:flex; justify-content:center; align-items:center; position:relative;}
    
    video { position:fixed; top:0; left:0; width:100%; height:100%; object-fit:cover; z-index:-2;}
    #overlay { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,30,0.25); z-index:-1;}

    .dashboard-container {
      position: relative;
      z-index: 1;
      background: rgba(255,255,255,0.1);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 30px;
      width: 400px;
      max-height: 90%;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      box-shadow: 0 0 20px rgba(255,255,255,0.2);
    }

    .dashboard-container h2 {
      text-align:center;
      margin-bottom:20px;
      font-size:24px;
    }

    .chat-box {
      flex:1;
      overflow-y:auto;
      background: rgba(255,255,255,0.15);
      padding:15px;
      border-radius:15px;
      margin-bottom:15px;
    }

    .chat-message {
      margin:8px 0;
      max-width:80%;
      padding:10px;
      border-radius:10px;
      line-height:1.4;
    }

    .chat-message.user { background-color: rgba(179,217,255,0.7); margin-left:auto; text-align:right; }
    .chat-message.staff { background-color: rgba(230,242,255,0.7); margin-right:auto; text-align:left; }

    .reply-section { display:flex; }
    .reply-section input { flex:1; padding:10px; border-radius:30px 0 0 30px; border:none; outline:none; background: rgba(255,255,255,0.2); color:white; }
    .reply-section button { padding:10px 15px; border:none; border-radius:0 30px 30px 0; background:#00bcd4; color:white; cursor:pointer; transition:0.3s;}
    .reply-section button:hover { background:#0097a7; }

    .logout-btn { margin-top:10px; padding:10px; border:none; border-radius:30px; background:#ff4c4c; cursor:pointer; transition:0.3s;}
    .logout-btn:hover { background:#e03e3e; }
  </style>
</head>
<body>
  <video autoplay muted loop>
    <source src="Sea.mp4" type="video/mp4">
  </video>
  <div id="overlay"></div>

  <div class="dashboard-container">
    <h2>Staff Dashboard</h2>
    <div class="chat-box" id="chatBox"></div>
    <div class="reply-section">
      <input type="text" id="staffMessage" placeholder="Type your reply..." />
      <button id="sendBtn">Send</button>
    </div>
    <button class="logout-btn" id="logoutBtn">Logout</button>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
    import { getDatabase, ref, push, onChildAdded } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAwh0XKzZx_7swkunaE9LdMzJzm73hd-M4",
      authDomain: "togather-b1b1e.firebaseapp.com",
      databaseURL: "https://togather-b1b1e-default-rtdb.europe-west1.firebasedatabase.app/",
      projectId: "togather-b1b1e",
      storageBucket: "togather-b1b1e.firebasestorage.app",
      messagingSenderId: "44660039561",
      appId: "1:44660039561:web:744415b60ba559a77b0b58",
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const chatRef = ref(db, "chat");

    const chatBox = document.getElementById("chatBox");
    const staffMessage = document.getElementById("staffMessage");
    const sendBtn = document.getElementById("sendBtn");

    // Load chat messages
    onChildAdded(chatRef, snapshot => {
      const msg = snapshot.val();
      if (!msg || !msg.text || !msg.sender) return;

      const div = document.createElement("div");
      div.classList.add("chat-message");
      if(msg.sender === "User") {
        div.classList.add("user");
      } else {
        div.classList.add("staff");
      }
      div.innerHTML = `<strong>${msg.sender}:</strong> ${msg.text}`;
      chatBox.appendChild(div);
      chatBox.scrollTop = chatBox.scrollHeight;
    });

    // Send staff reply
    sendBtn.addEventListener("click", () => {
      const text = staffMessage.value.trim();
      if (!text) return;

      push(chatRef, { sender:"Staff", text:text });
      staffMessage.value = "";
    });

    staffMessage.addEventListener("keypress", e => {
      if(e.key==="Enter"){ e.preventDefault(); sendBtn.click(); }
    });

    // Logout
    document.getElementById("logoutBtn").addEventListener("click", () => {
      alert("Logged out successfully!");
      window.location.href = "login.html";
    });
  </script>
</body>
</html>
